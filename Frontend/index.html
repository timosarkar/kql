<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KQL Query Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Prism.js for syntax highlighting -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism-tomorrow.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-bash.min.js"></script>

  <style>
    /* Custom animations and transitions */
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-appear {
      animation: modalAppear 0.2s ease-out;
    }

    @keyframes modalAppear {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .search-focus {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Custom scrollbar for modal */
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #374151;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #6b7280;
      border-radius: 4px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }

    /* Gradient background */
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* Glass morphism effect */
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body class="min-h-screen gradient-bg">

<div class="container mx-auto px-4 py-8 max-w-6xl">
  <!-- Header -->
  <div class="text-center mb-10">
    <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">
      KQL Query Explorer
    </h1>
    <p class="text-xl text-white/80 font-light">
      Discover and explore Kusto Query Language examples
    </p>
  </div>

  <!-- Search Section -->
  <div class="mb-8 max-w-2xl mx-auto">
    <div class="relative">
      <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
        <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      <input id="search" type="text" placeholder="Search queries by name or description..." 
             class="w-full pl-12 pr-4 py-4 text-lg rounded-2xl border-0 shadow-xl transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-300/50 bg-white/95 backdrop-blur-sm">
    </div>
  </div>

  <!-- Results count -->
  <div id="results-count" class="text-center mb-6 text-white/70 font-medium"></div>

  <!-- Query Grid -->
  <div id="query-list" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>

  <!-- Empty state -->
  <div id="empty-state" class="hidden text-center py-16">
    <svg class="mx-auto h-24 w-24 text-white/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.137 0-4.146-.832-5.657-2.343m0-3.314a7.963 7.963 0 0111.314 0M5 18.5h14A1.5 1.5 0 0120.5 17V7A1.5 1.5 0 0019 5.5H5A1.5 1.5 0 003.5 7v10A1.5 1.5 0 005 18.5z"></path>
    </svg>
    <h3 class="text-2xl font-medium text-white/70 mb-2">No queries found</h3>
    <p class="text-white/50">Try adjusting your search terms</p>
  </div>
</div>

<!-- Full-Screen Modal -->
<div id="query-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm hidden z-50 flex justify-center items-center p-4">
  <div class="bg-gray-900 w-full max-w-7xl h-5/6 rounded-2xl shadow-2xl overflow-hidden relative modal-appear">
    <!-- Close button -->
    <button id="modal-close" class="absolute top-6 right-6 text-white/70 hover:text-white text-2xl w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all duration-200 z-10">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Modal header -->
    <div class="bg-gradient-to-r from-gray-800 to-gray-700 p-6 border-b border-gray-600">
      <h2 id="modal-query-name" class="text-3xl font-bold text-white mb-2"></h2>
      <a id="modal-query-link" target="_blank" class="inline-flex items-center text-blue-400 hover:text-blue-300 transition-colors duration-200">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
        </svg>
        View on GitHub
      </a>
    </div>

    <!-- Modal content -->
    <div class="h-full overflow-auto custom-scrollbar bg-gray-900">
      <pre class="p-6"><code id="modal-query-content" class="language-bash text-sm leading-relaxed"></code></pre>
    </div>
  </div>
</div>

<!-- Loading spinner -->
<div id="loading" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40 flex items-center justify-center">
  <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto"></div>
    <p class="text-white mt-4 font-medium">Loading queries...</p>
  </div>
</div>

<script>
let queries = [];

// Show loading state initially
$('#loading').removeClass('hidden');

// Load queries.json
$.getJSON('queries.json')
  .done(data => {
    queries = data;
    renderList(queries);
    $('#loading').addClass('hidden');
  })
  .fail(() => {
    $('#loading').addClass('hidden');
    // Create sample data for demo
    queries = [
      {
        name: "Sample KQL Query 1",
        description: "Basic table filtering and projection",
        file: "https://github.com/sample/query1.kql",
        raw: "data:text/plain;base64," + btoa("// Sample KQL Query\nSecurityEvent\n| where TimeGenerated > ago(1d)\n| project TimeGenerated, Computer, EventID\n| take 100")
      },
      {
        name: "Sample KQL Query 2", 
        description: "Aggregation and time series analysis",
        file: "https://github.com/sample/query2.kql",
        raw: "data:text/plain;base64," + btoa("// Time series aggregation\nPerformanceCounters\n| where TimeGenerated > ago(7d)\n| summarize avg(CounterValue) by bin(TimeGenerated, 1h), CounterName\n| render timechart")
      },
      {
        name: "Advanced Analytics Query",
        description: "Complex joins and statistical functions",
        file: "https://github.com/sample/query3.kql",
        raw: "data:text/plain;base64=" + btoa("// Advanced analytics example\nSecurityEvent\n| where TimeGenerated > ago(30d)\n| join kind=inner (\n    IdentityInfo\n    | project AccountName, AccountDomain\n) on $left.Account == $right.AccountName\n| summarize EventCount = count() by AccountName, EventID\n| where EventCount > 10\n| order by EventCount desc")
      }
    ];
    renderList(queries);
  });

// Search filter with debounce
let searchTimeout;
$('#search').on('input', function() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    const term = $(this).val().toLowerCase();
    const filtered = queries.filter(q =>
      q.name.toLowerCase().includes(term) ||
      (q.description && q.description.toLowerCase().includes(term))
    );
    renderList(filtered);
  }, 300);
});

// Render query list
function renderList(list) {
  const $container = $('#query-list');
  const $emptyState = $('#empty-state');
  const $resultsCount = $('#results-count');
  
  $container.empty();
  
  if (list.length === 0) {
    $emptyState.removeClass('hidden');
    $resultsCount.text('');
    return;
  }
  
  $emptyState.addClass('hidden');
  $resultsCount.text(`${list.length} ${list.length === 1 ? 'query' : 'queries'} found`);
  
  list.forEach((q, index) => {
    const $card = $(`
      <div class="group bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg hover:shadow-2xl cursor-pointer transition-all duration-300 transform hover:-translate-y-1 hover:bg-white fade-in overflow-hidden"
           style="animation-delay: ${index * 0.05}s">
        <div class="p-6">
          <div class="flex items-start justify-between mb-3">
            <h3 class="font-bold text-xl text-gray-800 group-hover:text-blue-600 transition-colors duration-200 leading-tight">${q.name}</h3>
            <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors duration-200 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </div>
          ${q.description ? `
            <p class="text-gray-600 text-sm leading-relaxed mb-4">${q.description}</p>
          ` : ""}
          <div class="flex items-center text-xs text-gray-400">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg>
            KQL Query
          </div>
        </div>
        <div class="h-1 bg-gradient-to-r from-blue-500 to-purple-600 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
      </div>
    `);
    
    $card.on('click', () => openModal(q));
    $container.append($card);
  });
}

// Open modal and load query content
async function openModal(q) {
  $('#query-modal').removeClass('hidden');
  $('#modal-query-name').text(q.name);
  $('#modal-query-link').attr('href', q.file);
  $('#modal-query-content').text('Loading query content...');

  try {
    const res = await fetch(q.raw);
    const text = await res.text();
    // Escape HTML for Prism
    const escaped = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    $('#modal-query-content').html(escaped);
    Prism.highlightElement(document.getElementById('modal-query-content'));
  } catch (err) {
    $('#modal-query-content').text('⚠️ Error loading query content. Please check the source link.');
  }
}

// Close modal
$('#modal-close').on('click', () => $('#query-modal').addClass('hidden'));

// Close modal when clicking outside content
$('#query-modal').on('click', function(e) {
  if (e.target === this) $(this).addClass('hidden');
});

// Close modal with Escape key
$(document).on('keydown', function(e) {
  if (e.key === 'Escape') {
    $('#query-modal').addClass('hidden');
  }
});

// Focus search on page load
$(document).ready(function() {
  $('#search').focus();
});
</script>

</body>
</html>
